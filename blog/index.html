<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Consent Mode + Analytics -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  // Set default consent mode to denied before any tracking
  gtag('consent', 'default', {
    'analytics_storage': 'denied',
    'ad_storage': 'denied',
    'wait_for_update': 500
  });
  
  // Load Google Analytics
  gtag('js', new Date());
  gtag('config', 'G-V3K8KE25ZW', {
    'send_page_view': false  // We'll send it after consent
  });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V3K8KE25ZW"></script>


    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P2747G38');</script>
<!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Archive - All Posts | Idol Brands</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <meta name="description" content="Browse all blog posts from Idol Brands - fashion industry insights, creator brand building tips, and success stories.">
    <meta name="robots" content="index, follow">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-display { font-family: 'Playfair Display', serif; }
    </style>
</head>
<body class="bg-white">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P2747G38"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <nav class="bg-white border-b border-gray-200 py-4">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <a href="/" class="text-2xl font-display font-bold text-black">Idol Brands</a>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <h1 class="text-4xl font-display font-bold text-black mb-8">Blog Archive</h1>
        
        <div class="mb-8">
            <a href="/blog.html" class="text-blue-600 hover:underline">← Back to Blog (Dynamic View)</a>
        </div>

        <div id="blog-list" class="space-y-6">
            <p class="text-gray-600">Loading blog posts...</p>
        </div>
    </main>

    <script>
    // Load blog posts from CMS data and display as list
    async function loadBlogArchive() {
        const container = document.getElementById('blog-list');
        
        try {
            // Try to load from server
            const response = await fetch('/.netlify/functions/cms-content');
            const data = await response.json();
            
            let postsEN = [];
            let postsPL = [];
            
            if (data.blogPostsEN) {
                postsEN = JSON.parse(data.blogPostsEN);
            }
            if (data.blogPostsPL) {
                postsPL = JSON.parse(data.blogPostsPL);
            }
            
            if (postsEN.length === 0 && postsPL.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No blog posts available yet.</p>';
                return;
            }
            
            // Generate slug
            function generateSlug(title) {
                return title.toLowerCase().replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-').substring(0, 100);
            }
            
            let html = '';
            
            if (postsEN.length > 0) {
                html += '<h2 class="text-2xl font-bold mb-4">English Posts</h2>';
                html += '<div class="space-y-4 mb-8">';
                postsEN.reverse().forEach(post => {
                    const slug = generateSlug(post.title || 'untitled');
                    const url = '/blog/' + slug + '-en.html';
                    html += `
                        <div class="border-b border-gray-200 pb-4">
                            <h3 class="text-xl font-semibold mb-2">
                                <a href="${url}" class="text-black hover:text-blue-600">${post.title || 'Untitled'}</a>
                            </h3>
                            ${post.date ? `<p class="text-sm text-gray-500 mb-2">${post.date}</p>` : ''}
                            ${post.metaDescription ? `<p class="text-gray-600">${post.metaDescription}</p>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (postsPL.length > 0) {
                html += '<h2 class="text-2xl font-bold mb-4">Polskie Posty</h2>';
                html += '<div class="space-y-4">';
                postsPL.reverse().forEach(post => {
                    const slug = generateSlug(post.title || 'untitled');
                    const url = '/blog/' + slug + '-pl.html';
                    html += `
                        <div class="border-b border-gray-200 pb-4">
                            <h3 class="text-xl font-semibold mb-2">
                                <a href="${url}" class="text-black hover:text-blue-600">${post.title || 'Bez tytułu'}</a>
                            </h3>
                            ${post.date ? `<p class="text-sm text-gray-500 mb-2">${post.date}</p>` : ''}
                            ${post.metaDescription ? `<p class="text-gray-600">${post.metaDescription}</p>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            container.innerHTML = html;
            
        } catch (error) {
            console.error('Error loading blog posts:', error);
            container.innerHTML = '<p class="text-red-600">Error loading blog posts. Please try again later.</p>';
        }
    }
    
    loadBlogArchive();
    </script>

    <!-- Firebase SDK -->
    <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getAnalytics, logEvent, setAnalyticsCollectionEnabled } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDvFEcH-YXhKb7gFkSnBobaj4B3b7-_VqY",
      authDomain: "idol-brands.firebaseapp.com",
      projectId: "idol-brands",
      storageBucket: "idol-brands.firebasestorage.app",
      messagingSenderId: "764493539637",
      appId: "1:764493539637:web:e9a6a71ce9b36d73f1c47c",
      measurementId: "G-V3K8KE25ZW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const analytics = getAnalytics(app);
    
    // Disable analytics by default until consent is given
    setAnalyticsCollectionEnabled(analytics, false);
    
    // Listen for cookie consent changes
    document.addEventListener('cookieConsentUpdated', function(event) {
        const consent = event.detail;
        if (consent && consent.analytics) {
            // Enable Firebase Analytics when user consents
            setAnalyticsCollectionEnabled(analytics, true);
            logEvent(analytics, 'page_view', {
                page_title: document.title,
                page_location: window.location.href,
                page_path: window.location.pathname
            });
            console.log('Firebase Analytics enabled with consent');
        } else {
            // Disable if consent is withdrawn
            setAnalyticsCollectionEnabled(analytics, false);
            console.log('Firebase Analytics disabled');
        }
    });
    
    window.firestoreDB = db;
    window.firestoreAddDoc = addDoc;
    window.firestoreCollection = collection;
    window.firebaseAnalytics = analytics;
    </script>

</body>
</html>
